(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32254,e=>{"use strict";let t=(0,e.i(14560).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>t],32254)},90533,e=>{"use strict";let t=(0,e.i(14560).default)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],90533)},56245,e=>{"use strict";var t=e.i(79071),a=e.i(91176),r=e.i(55187),i=e.i(90533),s=e.i(32254),o=e.i(14560);let l=(0,o.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),c=(0,o.default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function d(){let e=(0,a.useRouter)(),o=(0,a.usePathname)();return(0,t.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 bg-green-600 px-4 py-2 flex justify-around items-center",children:[(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>e.push("/materials"),className:`flex flex-col items-center gap-1 p-2 ${"/materials"===o?"text-white":"text-green-100"}`,children:[(0,t.jsx)(i.FileText,{className:"w-6 h-6"}),(0,t.jsx)("span",{className:"text-xs",children:"Materials"})]}),(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>e.push("/scan"),className:`flex flex-col items-center gap-1 p-2 ${"/scan"===o?"text-white":"text-green-100"}`,children:[(0,t.jsx)(s.Camera,{className:"w-6 h-6"}),(0,t.jsx)("span",{className:"text-xs",children:"Scan"})]}),(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>e.push("/leaderboard"),className:`flex flex-col items-center gap-1 p-2 ${"/leaderboard"===o?"text-white":"text-green-100"}`,children:[(0,t.jsx)(l,{className:"w-6 h-6"}),(0,t.jsx)("span",{className:"text-xs",children:"Leaderboard"})]}),(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>e.push("/user"),className:`flex flex-col items-center gap-1 p-2 ${"/user"===o?"text-white":"text-green-100"}`,children:[(0,t.jsx)(c,{className:"w-6 h-6"}),(0,t.jsx)("span",{className:"text-xs",children:"User"})]})]})}e.s(["BottomNavigation",()=>d],56245)},24797,e=>{"use strict";e.i(16161);var t=e.i(7253),a=e.i(1371);let r="materials",i=async(e,i)=>{if(!a.db)throw Error("Firebase Firestore not initialized");try{return(await (0,t.addDoc)((0,t.collection)(a.db,r),{ownerUid:e,materialName:i.materialName,howToRecycle:i.howToRecycle,discoveredAt:t.Timestamp.fromDate(i.discoveredAt),similarMaterials:i.similarMaterials,imagePath:i.imagePath,audioPath:i.audioPath,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()})).id}catch(e){throw console.error("Error creating material:",e),e}},s=async(e,i={})=>{if(!a.db)throw Error("Firebase Firestore not initialized");try{let s,o=(0,t.query)((0,t.collection)(a.db,r),(0,t.where)("ownerUid","==",e),(0,t.orderBy)("discoveredAt","desc"));i.limit&&(o=(0,t.query)(o,(0,t.limit)(i.limit))),i.cursor&&(o=(0,t.query)(o,(0,t.startAfter)(i.cursor)));let l=await (0,t.getDocs)(o),c=[];return l.forEach(e=>{let t=e.data(),a={id:e.id,ownerUid:t.ownerUid,materialName:t.materialName,howToRecycle:t.howToRecycle,discoveredAt:t.discoveredAt?.toDate()||new Date,similarMaterials:t.similarMaterials||[],imagePath:t.imagePath,audioPath:t.audioPath,createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date};(!i.search||a.materialName.toLowerCase().includes(i.search.toLowerCase()))&&c.push(a)}),l.docs.length>0&&(s=l.docs[l.docs.length-1]),{materials:c,nextCursor:s}}catch(e){throw console.error("Error listing materials:",e),e}},o=async(e,i)=>{if(!a.db)throw Error("Firebase Firestore not initialized");try{let s=(0,t.doc)(a.db,r,i),o=await (0,t.getDoc)(s);if(!o.exists())return null;let l=o.data();if(l.ownerUid!==e)throw Error("Unauthorized access to material");return{id:o.id,ownerUid:l.ownerUid,materialName:l.materialName,howToRecycle:l.howToRecycle,discoveredAt:l.discoveredAt?.toDate()||new Date,similarMaterials:l.similarMaterials||[],imagePath:l.imagePath,audioPath:l.audioPath,createdAt:l.createdAt?.toDate()||new Date,updatedAt:l.updatedAt?.toDate()||new Date}}catch(e){throw console.error("Error getting material:",e),e}},l=async(e,i,s)=>{if(!a.db)throw Error("Firebase Firestore not initialized");try{let o=(0,t.doc)(a.db,r,i),l=await (0,t.getDoc)(o);if(!l.exists()||l.data().ownerUid!==e)throw Error("Unauthorized access to material");let c={...s,updatedAt:(0,t.serverTimestamp)()};s.discoveredAt&&(c.discoveredAt=t.Timestamp.fromDate(s.discoveredAt)),await (0,t.updateDoc)(o,c)}catch(e){throw console.error("Error updating material:",e),e}},c=async(e,i)=>{if(!a.db)throw Error("Firebase Firestore not initialized");try{let s=(0,t.doc)(a.db,r,i),o=await (0,t.getDoc)(s);if(!o.exists()||o.data().ownerUid!==e)throw Error("Unauthorized access to material");await (0,t.deleteDoc)(s)}catch(e){throw console.error("Error deleting material:",e),e}},d=async e=>{if(!a.db)throw Error("Firebase Firestore not initialized");try{let i=(0,t.query)((0,t.collection)(a.db,r),(0,t.where)("ownerUid","==",e)),s=(await (0,t.getDocs)(i)).size,o=new Date;o.setDate(o.getDate()-7);let l=(0,t.query)((0,t.collection)(a.db,r),(0,t.where)("ownerUid","==",e),(0,t.where)("discoveredAt",">=",t.Timestamp.fromDate(o)),(0,t.orderBy)("discoveredAt","asc")),c=(await (0,t.getDocs)(l)).size;return{totalDiscovered:s,discoveredThisWeek:c,points:s}}catch(e){throw console.error("Error computing user stats:",e),e}};e.s(["createMaterial",0,i,"deleteMaterial",0,c,"getMaterial",0,o,"getUserStats",0,d,"listMaterials",0,s,"updateMaterial",0,l])},40615,e=>{"use strict";let t=(0,e.i(14560).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],40615)},47138,e=>{"use strict";var t=e.i(79071),a=e.i(58277),r=e.i(91176),i=e.i(38926),s=e.i(24797),o=e.i(59030),l=e.i(55187),c=e.i(40615),d=e.i(37515),n=e.i(56245),h=e.i(49875);function m(){let[e,m]=(0,a.useState)(null),[u,x]=(0,a.useState)(!0),[w,p]=(0,a.useState)(!1),[g,y]=(0,a.useState)(!1),[b,v]=(0,a.useState)(null),[f,N]=(0,a.useState)(null),[j,A]=(0,a.useState)(null),[M,D]=(0,a.useState)(0),[k,z]=(0,a.useState)(null),U=(0,r.useRouter)();(0,a.useEffect)(()=>(0,i.onAuthStateChange)(e=>{m(e),x(!1),e||U.push("/")}),[U]);let T=async t=>{if(e){p(!0);try{let a={...t};j&&(a.audioPath=await (0,h.uploadMaterialAudio)(e.uid,j)),await (0,s.createMaterial)(e.uid,a),d.toast.success("Saved!"),U.push("/materials")}catch(e){console.error(e),d.toast.error("Failed to save material.")}finally{p(!1)}}},E=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e,{mimeType:"audio/webm"}),a=[];t.ondataavailable=e=>{e.data.size&&a.push(e.data)},t.onstop=()=>{let t=new Blob(a,{type:"audio/webm"});A(t),N(URL.createObjectURL(t)),e.getTracks().forEach(e=>e.stop())},t.start(),v(t),y(!0);let r=setInterval(()=>{D(e=>{let a=e+1;return a>=30?(t.stop(),y(!1),r&&clearInterval(r),30):a})},1e3);z(r)}catch(e){console.error(e),d.toast.error("Microphone access denied.")}};return u?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})}):e?(0,t.jsxs)("div",{className:"min-h-screen bg-white pb-20",children:[(0,t.jsx)("div",{className:"bg-white border-b border-gray-200 px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>U.back(),className:"text-green-600",children:[(0,t.jsx)(c.ArrowLeft,{className:"w-4 h-4 mr-2"})," Back"]}),(0,t.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"New Material"}),(0,t.jsx)("div",{className:"w-16"})]})}),(0,t.jsxs)("div",{className:"px-4 py-6 max-w-md mx-auto",children:[(0,t.jsx)("div",{className:"bg-white rounded-2xl border border-gray-200 p-4 mb-4 text-center text-gray-700",children:"You Discovered A New Material! Describe it and add a photo."}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 p-4 mb-4",children:[(0,t.jsx)("h2",{className:"text-sm font-medium mb-2",children:"Add an audio note"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[g?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Button,{onClick:()=>{b&&g&&(b.stop(),y(!1),k&&(clearInterval(k),z(null)))},variant:"outline",children:"Stop"}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[30-M,"s remaining"]})]}):(0,t.jsx)(l.Button,{onClick:E,className:"bg-green-600 hover:bg-green-700 text-white",children:"Start Recording"}),f&&(0,t.jsx)("audio",{src:f,controls:!0,className:"flex-1"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Audio will be saved with the material."})]}),(0,t.jsx)(o.MaterialForm,{onSubmit:T,isLoading:w,userId:e.uid})]}),(0,t.jsx)(n.BottomNavigation,{})]}):null}e.s(["default",()=>m])}]);